trigger:
  branches:
    include:
    - master
  paths:
    include:
    - build/azure-devops/Handyman.DataContractValidator.yml
    - src/Handyman.DataContractValidator/*
    - test/Handyman.DataContractValidator.Tests/*

variables:
  configuration: release

pool:
  vmImage: 'vs2017-win2016'

steps:
- script: |
    dotnet restore ./src/Handyman.DataContractValidator/Handyman.DataContractValidator.csproj --force
    dotnet restore ./test/Handyman.DataContractValidator.Tests/Handyman.DataContractValidator.Tests.csproj --force
  displayName: dotnet restore

- script: |
    dotnet build ./src/Handyman.DataContractValidator/Handyman.DataContractValidator.csproj --configuration $(configuration)
    dotnet build ./test/Handyman.DataContractValidator.Tests/Handyman.DataContractValidator.Tests.csproj --configuration $(configuration)
  displayName: dotnet build

- task: DotNetCoreCLI@2
  displayName: dotnet test
  inputs:
    command: test
    projects: './test/Handyman.DataContractValidator.Tests/Handyman.DataContractValidator.Tests.csproj'
    arguments: '--configuration $(configuration)'

- task: NuGetToolInstaller@0
  displayName: update nuget.exe
  inputs:
    versionSpec: '4.9.3'

- task: NuGetCommand@2
  displayName: nuget pack
  inputs:
    command: pack
    packagesToPack: ./src/Handyman.DataContractValidator/Handyman.DataContractValidator.csproj
    configuration: $(configuration)
    includeSymbols: true
    packDestination: $(Build.ArtifactStagingDirectory)

- task: PublishPipelineArtifact@0
  displayName: publish artifacts
  inputs:
    artifactName: 'nuget'
    targetPath: $(Build.ArtifactStagingDirectory)
